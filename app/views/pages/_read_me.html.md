# Book Management System

A quick demonstration of a book management system API.

  You can create a new user, and view the user at a later date to check the balance
and the books they have borrowed.

  A user can see a list of books or an individual book where it displays the fee
and how many are left. The user can also check the earnings of the book in a
given timeframe.

  A user can also view all the borrowed books that are currently on loan and the
history. They can borrow a new book or return a book which has already been
borrowed. Finally, they can check how many have been loaned, currently on loan,
and the total earnings.

## Requirements

Ruby 2.6.6

### Start up

``` bundle install ```

``` rails db:create db:migrate db:seed ```

``` rails s ```

### Endpoints

- POST  /v1/users
      - Needs a body ( {“user”: {“balance”: 2000} } )
- GET   /v1/users/:id

- GET   /v1/books
- GET   /v1/books/:id
- GET   /v1/books/:id/search
      - Needs a body ( {“from_date”:”2020-12-13”, “to_date”:”2020-12-15”} )

- GET   /v1/borrowed_books
- POST  /v1/borrowed_books
      - Needs a body ( {“borrowed_book”: {“user_id”: 2, “book_id”: 1} } )
- PATCH /v1/borrowed_books/return_book
      - Needs a body ( {“borrowed_book”: {“user_id”: 1, “book_id”: 1} } )
- GET   /v1/borrowed_books/status

## Design Choices

### App Generation

- -T flag as I will be using RSpec
- --api flag to reduce middleware and Action Controller modules primarily used
for browsers

### Models

- User (Devise gem)
    - Balance (Set by user on generation)
    - Account Number (Autogenerated)
    - Email (Autogenerated incase of auth)
    - Password (Autogenerated incase of auth)
    - Validates the balance must be greater than 0
    - Subtract_book_fee method
    - Outstanding payments method

  To keep the controllers a little more manageable, I wanted to put some of the
logic into the user model, such as subtracting book fees and checking outstanding
payments from books currently being borrowed. I felt the logic didn’t require a
service and in the model would suffice. I felt it was important to have a method
to check the user’s outstanding payments for future references

- Book
    - Title (Seeded)
    - Available Quantity (Seeded)
    - Fee (Seeded)
    - Validates the available quantity must be greater than zero and uniqueness
    of book titles

  Similar to the User model, I created some methods to keep the code DRY and
reduce the code in the controllers.


- Borrowed Book
    - Book Returned (default false)
    - Book id
    - User id
    - Validates uniqueness of the Book when it is the same User
    - Validates the User’s balance before it can create
    - Class method to calculate earnings

  It was important before creating a new borrowed book to check whether the User
had enough balance to pay on returning the book. It checks whether the user has
any outstanding payments, and combines it with the fee of the new book to see if
it less than the user’s balance. If it is, it will allow the user to borrow a
book. The validation only needs to run when a book is created and not updated.

### Testing

  ``` bundle exec rspec ```

  For testing, I decided to go with the rspec and factory bot as this is my
experience in the past. Creating factories makes it easier to check model validations
and to build while checking API responses.

### Routes

  I decided that for my User model, I would only need a show and create.

  For the Book model, It would need an index and a show. I also made a member
route to search for a book’s earnings during a certain time period.

  For the BorrowedBook model, it would need an index and create action. Also, I
decided to create a custom PATCH request as a collection rather than just using
an update to make it clear the endpoint would only function to return a book.
Also, I made a custom GET path to check the overall status of the model.

### Views

  For the views I decided to use jbuilder as I am more comfortable with it and
you can render partials keeping the code DRY. I decided to make a template for
each action for clarity.
